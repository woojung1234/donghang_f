# 동행 프로젝트 계획서

## 프로젝트 개요
- **프로젝트명**: 동행 (donghang)
- **타입**: React 프론트엔드 + Node.js/Express 백엔드
- **포트**: 백엔드(9090), 프론트엔드(3000)

## 프로젝트 구조
```
donghang_f/
├── AI-main/          # FastAPI 기반 AI 서버 (포트 8000)
├── backend-main/     # Node.js/Express 백엔드 (포트 9090)
├── frontend-main/    # React 프론트엔드 (포트 3000)
├── docs/            # 프로젝트 문서
└── logs/            # 로그 파일
```

## 실행 방법
### AI 서버 (첫 번째)
```bash
cd AI-main
pip install -r requirements.txt
python app/main.py  # http://localhost:8000
```

### 백엔드 서버 (두 번째)
```bash
cd backend-main
npm install
npm run dev  # http://localhost:9090
```

### 프론트엔드 (세 번째)
```bash
cd frontend-main
npm install  
npm start   # http://localhost:3000
```

## 주요 기능
- **AI 챗봇 서비스** (FastAPI/Python)
  - OpenAI GPT 모델 통합
  - 챗봇 API: `/api/v1/chatbot/chatting`
  - TTS (텍스트 음성 변환)
- **백엔드 API** (Node.js/Express)
  - 사용자 인증 시스템
  - JWT 토큰 기반 인증
  - PostgreSQL/SQLite 데이터베이스 지원
  - SMS 인증 (CoolSMS)
  - API 문서화 (Swagger)
- **프론트엔드** (React)
  - 사용자 인터페이스
  - AI 챗봇 연동
  - 음성 인식 및 합성

## 완료된 작업
- [x] 프로젝트 구조 분석 완료
- [x] docs 폴더 생성
- [x] logs 폴더 생성
- [x] project_plan.md 초기 생성
- [x] OpenAI API 키 테스트 완료 ✅
  - 65개 모델 접근 가능 (GPT-4.5, GPT-4.1, O3, O4-mini 등)
- [x] AI 서버 실행 문제 해결 ✅
  - __init__.py 파일 생성으로 패키지 구조 수정
  - http://127.0.0.1:8000 에서 정상 실행 중
  - 챗봇 서비스 사용 가능
- [x] **마이페이지 정보 표시 및 프로필 수정 기능 완료** ✨👤
  - **문제 해결**: 회원가입 시 입력한 성별, 나이, 지병 정보가 마이페이지에 표시되지 않음
  - **정보 표시 개선**:
    * MyBasicInfo.js에 이름, 성별, 나이, 지병 필드 추가
    * 나이 자동 계산 함수 구현 (생년월일 → 나이 변환)
    * 전화번호 하이픈 포맷팅 유지
    * 지병 정보 표시 (없으면 "없음" 표시)
  - **프로필 수정 기능 추가**:
    * ProfileEdit.js 컴포넌트 새로 생성
    * 이름, 전화번호, 생년월일, 성별, 지병 수정 가능
    * 실시간 유효성 검사 및 에러 처리
    * 백엔드 API 연동 (PUT /api/v1/users)
  - **UI/UX 개선**:
    * 프로필 수정 버튼 추가
    * 수정 모드와 조회 모드 토글 기능
    * 취소/저장 버튼으로 직관적 조작
    * 로딩 상태 표시 및 에러 메시지 처리
  - **CSS 스타일링**:
    * 프로필 수정 폼 전용 스타일 추가
    * 입력 필드, 버튼 스타일링 개선
    * 반응형 디자인 적용
  - **로그 시스템**: 모든 이벤트에 콘솔 로그 추가로 디버깅 용이성 향상
  - **코드 구조 개선**: MyExtraInfo 컴포넌트 제거하고 MyBasicInfo로 통합
- [x] **금복이 자연스러운 대화 및 복지로 사이트 이동 기능 완료** ✨🤖
  - **자연스러운 대화 기능**:
    * "안녕?" → "안녕하세요! 오늘 기분은 어떠신가요? 필요한 정보가 있으시면 언제든 말씀해주세요! 😊"
    * "넌 뭘할수있어?" → "저는 주로 복지서비스 정보 안내와 금융 서비스 지원을 도와드릴 수 있어요! 혹시 구체적으로 필요한 내용을 알려주시면 더 자세히 도와드릴게요! 😊"
    * 감사 인사, 기분 문의, 날씨 관련 질문 등에 자연스러운 응답
    * 하드코딩 없이 AI가 다양한 응답 생성 (랜덤 선택으로 자연스러움 구현)
  - **복지로 사이트 이동 기능**:
    * "복지로 사이트로 이동해줘" → "복지로 사이트로 이동할 준비가 되었어요! 이동을 원하시면 확인 부탁드릴게요!"
    * 음성 응답 후 팝업창 자동 표시
    * "예/아니오" 버튼으로 사용자 확인
    * "예" 클릭 시 새 탭에서 https://www.bokjiro.go.kr 자동 이동
    * 팝업 닫힌 후 음성 인식 자동 재시작
  - **백엔드 AI 서비스 개선**:
    * analyzeWelfarePortalRequest() 함수로 복지로 이동 요청 감지
    * generateNaturalGreeting(), generateCapabilityResponse() 함수로 자연스러운 응답 생성
    * getNaturalResponse() 함수로 기존 딱딱한 응답을 자연스럽게 개선
    * 우선순위 기반 메시지 처리 (인사 → 기능문의 → 복지로이동 → 기타)
  - **프론트엔드 UI/UX 개선**:
    * VoiceChat.js에 confirmModal 상태 추가
    * Modal 컴포넌트를 활용한 깔끔한 확인 팝업
    * 팝업 스타일링으로 사용자 친화적 인터페이스
    * chatScript.js에 showWelfarePortalConfirm() 함수로 팝업 처리
  - **사용자 경험 향상**:
    * 음성 + 팝업 + 자동 이동의 자연스러운 플로우
    * 사용자 의도를 정확히 파악하여 적절한 응답 제공
    * 대화의 연속성과 자연스러움 확보
- [x] **음성 응답 이모티콘 제거 완료** ✨🔇
  - **문제**: 음성으로 답변할 때 "지구본", "별표", "웃는얼굴" 등 이모티콘이 그대로 읽혀서 부자연스러움
  - **해결**: 모든 AI 응답에서 이모티콘 완전 제거
    * generateNaturalGreeting(): 인사 응답 이모티콘 제거
    * generateCapabilityResponse(): 기능 소개 응답 이모티콘 제거
    * generateWelfarePortalResponse(): 복지로 이동 응답 이모티콘 제거
    * formatSimpleWelfareRecommendation(): 복지서비스 추천 이모티콘 제거
    * getDefaultActivityRecommendation(): 기본 활동 추천 이모티콘 제거
    * generateSmartResponse(): 소비내역 저장 응답 이모티콘 제거
    * getNaturalResponse(): 일반 응답 이모티콘 제거
    * getOfflineResponse(): 오프라인 응답 이모티콘 제거
  - **결과**: 
    * "안녕하세요! 오늘 기분은 어떠신가요?" (자연스러운 음성)
    * "복지로 사이트로 이동할 준비가 되었어요!" (깔끔한 음성)
    * "5000원 점심 지출을 가계부에 저장했어요!" (명확한 음성)
  - **개선 효과**: 음성 합성 시 자연스럽고 깔끔한 발음으로 사용자 경험 향상
- [x] **소비내역 조회 기능 수정 완료** ✨💰
  - **문제**: "내 소비내역 알려줘", "한달 소비내역 알려달라고" 입력 시 일반 응답만 나오고 소비내역 조회가 안됨
  - **원인**: processMessage 함수에서 소비내역 조회 로직이 빠져있었음
  - **해결 작업**:
    * `isExpenseInquiry()`: 소비내역 조회 요청 감지 함수 추가
    * `getExpenseHistory()`: 소비내역 조회 함수 추가  
    * `analyzePeriodFromMessage()`: 메시지에서 기간 분석 함수 추가
    * `formatExpenseHistory()`: 조회 결과 포맷팅 함수 추가
    * processMessage 함수에 소비내역 조회 로직 우선순위 6번으로 추가
  - **지원하는 조회 패턴**:
    * "내 소비내역 알려줘" → 최근 30일 소비내역
    * "오늘 소비내역" → 오늘 소비내역
    * "이번달 소비내역" → 이번달 소비내역
    * "지난주 소비내역" → 지난주 소비내역
  - **응답 포맷**:
    * 총 소비 금액 및 거래 건수
    * 카테고리별 소비 통계 (상위 3개)
    * 최근 거래 내역 (최대 5개)
    * 소비내역 페이지 안내
  - **결과**: 음성/텍스트로 "내 소비내역 알려줘" 입력 시 정상적으로 소비내역 조회 및 음성 응답 제공
- [x] **AI 응답 개인화 및 맥락 인식 대폭 개선** ✨🧠
  - **문제**: "5월 소비내역 중 가장 적게사용한 카테고리는 뭐야?" 같은 구체적 질문에도 항상 정형화된 패턴으로만 응답
  - **질문 의도 분석 시스템 구축**:
    * `analyzeExpenseQuestion()`: 질문 유형을 6가지로 분류
      - `category_most`: 가장 많이 사용한 카테고리
      - `category_least`: 가장 적게 사용한 카테고리  
      - `category_ranking`: 카테고리별 순위 비교
      - `category_breakdown`: 카테고리별 세부 분석
      - `merchant_analysis`: 상점/장소 분석
      - `expense_summary`: 총액/요약 정보
      - `general_inquiry`: 일반적인 내역 조회
  - **맞춤형 응답 시스템**:
    * `formatHighestCategoryResponse()`: "가장 많이 사용한 카테고리는 **의료비**예요! 700만원으로 전체의 97%를 차지하고 있네요."
    * `formatLowestCategoryResponse()`: "가장 적게 사용한 카테고리는 **쇼핑**예요! 10만원으로 전체의 1%만 사용하셨네요."
    * `formatCategoryComparisonResponse()`: 카테고리별 순위와 퍼센트를 표로 정리
    * `formatMerchantAnalysisResponse()`: 자주 이용한 상점 TOP 5 분석
    * `formatExpenseSummaryResponse()`: 총액, 평균, 최고/최저 카테고리 종합 분석
  - **기간 인식 개선**:
    * `getPeriodFromMessage()`: "5월", "4월", "3월" 등 구체적 월 인식
    * "오늘", "어제", "이번주", "지난주", "이번달", "지난달" 정확한 구분
  - **자연스러운 응답 생성**:
    * 질문 맥락에 맞는 개인화된 답변
    * 이모지와 강조 표시로 가독성 향상  
    * `calculateMerchantStats()`: 상점별 이용 통계 자동 계산
    * `getCategoryEmoji()`: 카테고리별 적절한 이모지 자동 선택
  - **응답 다양성 확보**:
    * `getNaturalResponse()`: 8가지 상황별 다양한 응답 패턴
    * 인사, 도움요청, 감사인사, 기분문의 등 각각 3-4가지 응답 변형
    * 랜덤 선택으로 매번 다른 자연스러운 대화
  - **개선 효과**:
    * **이전**: "5월 소비내역 중 가장 적게사용한 카테고리는 뭐야?" → "최근 소비내역을 알려드릴게요. 총 소비 금액은..."
    * **이후**: "5월 가장 적게 사용한 카테고리는 **쇼핑**예요! 10만원으로 전체의 1%만 사용하셨네요. 반대로 가장 많이 사용한 건 의료비 카테고리였어요."
  - **사용자 경험**: AI가 질문을 정확히 이해하고 구체적이고 개인화된 답변 제공
- [x] **/api/v1/match 관련 코드 완전 제거** ✨🗑️
  - **문제**: 사용되지 않는 /api/v1/match API 경로가 백엔드에 남아있어서 불필요한 차단 미들웨어 존재
  - **제거 작업**:
    * `app.js`에서 `/api/v1/match*` 경로 차단 미들웨어 완전 제거
    * 410 상태코드 반환하는 코드 제거
    * "이 API 경로는 더 이상 사용되지 않습니다" 메시지 제거
    * 불필요한 로그 출력 코드 제거
  - **확인된 사실**:
    * 프론트엔드에서 /api/v1/match 호출하는 코드 없음
    * 백엔드에서 해당 API 구현 코드 없음  
    * AI 서버에서도 관련 코드 없음
  - **정리 완료**:
    * 백엔드 코드가 더 깔끔해짐
    * 불필요한 미들웨어 제거로 성능 소폭 개선
    * 코드 유지보수성 향상
  - **프론트엔드 정리** ✅ **완료**:
    * `WelfareMain.js`에서 `/api/v1/match` API 호출 코드 제거 ✅
    * `Button.js`에서 `/api/v1/match` API 호출을 `/api/v1/users`로 변경 ✅
    * `LoginBio.js`에서 매칭 체크 로직 제거하고 직접 홈으로 이동 ✅
    * `ProfileA.js`에서 `/api/v1/match`를 `/api/v1/users`로 변경 ✅
    * `DisconnectionModal.js`에서 매칭 해제 기능 제거 ✅
    * `WelfareCheckSpec.js`에서 보호자 로직 제거하고 사용자 정보 조회로 통합 ✅
    * `WelfareHanwoolModal.js`에서 `/api/v1/match`를 `/api/v1/users`로 변경 ✅
    * `WelfareHouseworkModal.js`에서 `/api/v1/match`를 `/api/v1/users`로 변경 ✅
    * `WelfareList.js`에서 보호자 분기 로직 제거하고 단일 사용자 정보 조회로 통합 ✅
    * `WelfareNursingModal.js`에서 `/api/v1/match`를 `/api/v1/users`로 변경 ✅
    * `WelfareReservedList.js`에서 보호자 매칭 로직 제거 ✅
  - **AI 서버 정리** ✅:
    * `chatbot_router.py`에서 `/api/v1/match` 엔드포인트 완전 제거 ✅
  - **백엔드 정리** ✅:
    * `app.js`에서 `/api/v1/match*` 경로 차단 미들웨어 제거 ✅
  - **완전 정리 완료** 🎉: 
    * **프론트엔드, 백엔드, AI 서버 모든 곳에서 `/api/v1/match` 관련 코드 100% 제거 완료**
    * **보호자(PROTECTOR) - 피보호자(PROTEGE) 매칭 시스템 완전 제거**
    * **모든 사용자를 일반 사용자로 통합하여 단순화**
    * **코드 복잡도 대폭 감소 및 유지보수성 향상**

- [x] **보호자 관련 흔적 완전 제거 완료** ✨🧹
  - **문제**: 애플리케이션에서 보호자 기능을 사용하지 않는데도 여러 파일에 보호자 관련 코드와 주석이 남아있음
  - **정리 작업**:
    * `WelfareReservedList.js`: 보호자 관련 주석 제거 및 코드 단순화 ✅
    * `WelfareList.js`: 보호자 주석 제거, welfare-protegeName → welfare-username 클래스명 변경 ✅
    * `WelfareCheckSpec.js`: protege 관련 변수명을 user로 통일 (protegeAddress → userAddress 등) ✅
    * `RoleCheck.js`: PROTEGE → USER 타입으로 변경, 보호자 관련 주석 정리 ✅
    * `ProfileA.js`: protectorName, protegeName 변수를 userName으로 통합 및 단순화 ✅
  - **개선 효과**:
    * 코드 가독성 및 일관성 향상
    * 불필요한 보호자 로직 제거로 복잡도 감소
    * 유지보수성 개선
    * 단일 사용자 기반 애플리케이션으로 명확화

- [x] **소비내역 입력 플로우 수정 완료** ✨💰
  - **문제**: "5,000원 점심 먹었어" 입력 시 일반 응답만 나오고 날짜 확인 플로우가 작동하지 않음
  - **원인**: 백엔드 AI 서비스에서 소비내역 입력 처리 우선순위와 날짜 확인 로직에 문제
  - **수정 작업**:
    * `aiChatService.js`의 `processMessage()` 함수에서 처리 순서 재정렬 ✅
    * 날짜 확인 대기 상태 처리 로직 추가 (우선순위 4번) ✅
    * 소비내역 입력 감지를 소비내역 조회보다 먼저 처리 (우선순위 5번) ✅
    * 날짜 확인이 필요한 경우와 불필요한 경우 분리 처리 ✅
    * 중복된 기존 소비내역 처리 로직 제거 ✅
    * `formatDateForResponse()` 함수 추가로 사용자 친화적 날짜 표시 ✅
  - **새로운 플로우**:
    1. "5,000원 점심 먹었어" → 소비내역 파싱 성공
    2. 날짜 정보 없음 → "일반음식점에서 5,000원 식비 지출이군요! 언제 사용하셨나요?"
    3. "오늘" 답변 → 오늘 날짜로 소비내역 저장
    4. "네! 오늘 일반음식점에서 5,000원 식비 지출을 가계부에 저장했어요!"
  - **세션 상태 관리**: 
    * `waitingForDateConfirmation`: 날짜 확인 대기 상태
    * `pendingExpenseData`: 임시 저장된 소비내역 데이터
  - **결과**: 원래 의도했던 대화형 소비내역 입력 플로우 완전 복구

- [x] **날짜 파싱 및 소비 키워드 인식 오류 수정 완료** ✨📅
  - **문제**: "5월 15일", "10일전", "3일전", "75,000원 쇼핑 했어" 등이 인식되지 않음
  - **원인 분석**:
    * `extractDateFromText()` 함수의 정규식 패턴에 잘못된 이스케이프 문자 사용
    * "쇼핑" 키워드가 소비 키워드 목록에 누락
    * `today` 변수 정의 오류로 "N일 전", "월일" 패턴 처리 실패
  - **수정 작업**:
    * 정규식 패턴 수정: `/(\\\\d+)/` → `/(\d+)/` ✅
    * 소비 키워드 확장: "쇼핑", "지출", "결제", "사용" 추가 ✅
    * 카테고리 분류 개선: 쇼핑→쇼핑카테고리, 교통→교통비, 의료→의료비 ✅
    * `extractDateFromText()` 함수 완전 재구성 ✅
    * KST 기준 날짜 계산 함수 정상화 ✅
  - **개선된 인식 패턴**:
    * **상대 날짜**: "오늘", "어제", "그제/그저께", "N일 전" ✅
    * **절대 날짜**: "5월 15일", "15일" (현재 월 기준) ✅
    * **소비 표현**: "75,000원 쇼핑 했어" → 쇼핑 카테고리로 정확히 분류 ✅
    * **금액 표현**: "6만 원", "7천원", "5,000원" 모두 정확히 파싱 ✅
  - **테스트 결과**:
    * "75,000원 쇼핑 했어" → "일반상점에서 75,000원 쇼핑 지출이군요! 언제 사용하셨나요?" ✅
    * "5월 15일" → 2025-05-15로 정확히 변환 ✅
    * "3일전" → 현재 날짜 기준 3일 전 날짜로 정확히 계산 ✅
  - **결과**: 사용자 입력의 날짜 및 소비 표현 인식률 대폭 향상

- [x] **소비내역 페이지 인라인 달력 구현 완료** ✨📅
  - **문제**: 기간설정 버튼 클릭 시 모달창이 나타나는 방식이 불편함
  - **요구사항**: 기간설정 버튼 클릭 시 바로 아래에 달력이 나타나는 인라인 방식으로 변경
  - **구현 작업**:
    * `InlineDatePicker.js` 컴포넌트 새로 생성 ✅
    * `InlineDatePicker.css` 전용 스타일 생성 ✅
    * `Consumption.js`에서 모달 방식을 인라인 방식으로 변경 ✅
    * `showDatePicker` 상태로 인라인 달력 토글 제어 ✅
    * 기존 `ConsumDateModal` 제거 및 코드 정리 ✅
  - **인라인 달력 기능**:
    * 기간설정 버튼 클릭 → 바로 아래 부드러운 애니메이션으로 달력 표시 ✅
    * 시작날짜/종료날짜 입력 필드 ✅
    * 빠른 날짜 선택 버튼: "오늘", "최근 1주일", "이번 달", "최근 3개월" ✅
    * 확인/취소 버튼으로 날짜 적용 또는 닫기 ✅
    * 닫기 버튼(×)으로 언제든 달력 숨기기 ✅
  - **UX/UI 개선**:
    * 슬라이드 다운 애니메이션 효과 ✅
    * 모바일 반응형 디자인 적용 ✅
    * 큰 버튼과 명확한 레이블로 사용자 친화적 설계 ✅
    * 날짜 유효성 검사 (시작일 ≤ 종료일) ✅
  - **결과**: 모달창 없이 바로 아래 펼쳐지는 직관적인 달력 인터페이스로 사용자 경험 향상

- [x] **복지서비스 예약 시 알림 생성 기능 완료** ✨🔔
  - **문제**: 복지서비스를 예약하거나 취소할 때 사용자에게 알림이 전송되지 않아 불편함
  - **복지서비스 예약 알림 시스템 구축**:
    * NotificationService에 복지서비스 전용 알림 생성 함수 추가
    * `createWelfareBookingNotification()`: 예약 완료 알림 생성
    * `createWelfareBookingCancelNotification()`: 예약 취소 알림 생성
    * `createWelfareBookingReminderNotification()`: 예약 확인 알림 생성 (예약일 전날)
  - **알림 내용 개선**:
    * 예약 완료: "복지서비스 예약 완료" + 서비스명, 예약기간, 총비용, 예약번호
    * 예약 취소: "복지서비스 예약 취소" + 서비스명, 취소된 예약기간, 예약번호
    * 예약 확인: "복지서비스 예약 안내" + 내일 예약 안내, 서비스 날짜
  - **WelfareBookService 연동**:
    * 복지서비스 예약 생성 시 자동으로 완료 알림 생성
    * 복지서비스 예약 취소 시 자동으로 취소 알림 생성
    * 알림 생성 실패해도 예약 프로세스는 정상 진행 (안정성 확보)
  - **홈페이지 헤더 알림 버튼 완성**:
    * 알림 아이콘 클릭 시 `/alarm` 페이지로 이동
    * 읽지 않은 알림 수를 실시간 표시 (빨간 뱃지)
    * 30초마다 자동 업데이트로 실시간성 확보
    * 모바일 반응형 디자인 적용
  - **소비내역 등록 시 알림 시스템 기존 완성**:
    * 소비내역 등록 시 자동으로 알림 생성 (PAYMENT 타입)
    * 큰 금액(10만원 이상) 소비 시 이상 징후 알림 생성 (ANOMALY 타입, HIGH 우선순위)
    * 알림 내용에 상점명, 금액, 카테고리 정보 포함
- [x] **홈페이지 복지서비스 예약하기 버튼 추가 완료** ✨🔘
  - **위치**: 홈페이지 복지서비스 섹션에 "복지서비스 이용하기" 버튼 옆에 추가
  - **버튼 기능**:
    * "복지서비스 예약하기" 버튼 클릭 시 `/welfare-reserved-list` 페이지로 이동
    * 사용자의 복지서비스 예약 내역을 조회하고 관리할 수 있는 페이지
  - **UI/UX 개선**:
    * 두 버튼을 나란히 배치 (Flexbox 레이아웃)
    * "복지서비스 이용하기": 화이트 배경, 기본 스타일
    * "복지서비스 예약하기": 주황색 배경 (#FF6B35), 강조 스타일
    * 호버 효과: 약간의 그림자 증가 및 위로 이동 애니메이션
    * 모바일 반응형: 작은 화면에서는 세로로 배치
  - **기술적 구현**:
    * `WelfareSlide.js`에서 두 번째 버튼 추가
    * `WelfareSlide.css`에서 버튼 컨테이너 및 스타일 정의
    * `handleGoWelfareReservation()` 함수로 예약 내역 페이지 이동
    * 반응형 디자인으로 모바일/태블릿 대응
  - **연결된 기능**:
    * 예약 내역 조회 (`/welfare-reserved-list`)
    * 예약 취소 기능 (WelfareReserveCancelModal)
    * 예약 완료 시 알림 자동 생성 연동
  - **결과**: 사용자가 홈페이지에서 바로 복지서비스 예약 관리에 접근 가능

## 해야 할 작업
- [ ] **리팩토링된 시스템 테스트** 🔧
  - [ ] 새로운 백엔드 AI 서비스 API 테스트
  - [ ] 프론트엔드 chatScript_new.js 적용 및 테스트
  - [ ] 기존 chatScript.js → chatScript_new.js 교체
  - [ ] 대화형 시스템 정상 작동 확인
  - [ ] 소비내역 입력/조회 기능 테스트
- [ ] 로그 설정 구성
- [ ] 데이터베이스 연결 확인

## 테스트 계정
- 아이디: example@example.com
- 비밀번호: testpassword

## 최근 업데이트
- 2025-05-25: 프로젝트 초기 분석 및 실행 방법 정리
- 2025-05-25: 음성 소비내역 입력 문제 해결
  - API URL 환경변수 수정 (localhost:9090 → localhost:5000)
  - 음성 입력 → 소비내역 표시 연동 확인
- 2025-05-26: 음성채팅 UI 개선 ✅
  - 전송 버튼 텍스트 가로 표시 CSS 수정
  - writing-mode: horizontal-tb 적용으로 "전송" 텍스트 정상 표시
- 2025-05-26: 소비내역 조회 오류 수정 ✅
  - ConsumptionController.js에서 `consumptionNo` → `consumption_no` 컬럼명 수정
  - NotificationController.js에서 `notificationNo` → `notification_no` 컬럼명 수정
  - ConsumptionService.js 완전 재작성 (구 모델 → 신 모델 구조로 변경)
    - `consumptionAmount` → `amount`
    - `consumptionCategory` → `category`
    - `consumptionDescription` → `memo`
    - `consumptionDate` → `transactionDate`
  - PostgreSQL DATE_TRUNC 함수 단위 수정 (`'DATE'` → `'day'`, `'WEEK'` → `'week'`, `'MONTH'` → `'month'`)
  - 라우트 우선순위 수정 (`/stats/:period`, `/report`, `/analysis`를 `/:consumptionId`보다 앞에 배치)
  - 데이터베이스 컬럼명과 Sequelize 쿼리 일치성 확보
- 2025-05-26: 텍스트 입력 및 소비내역 조회 기능 추가 ✅
  - chatScript.js에 소비내역 조회 함수 추가 (`getExpenseHistory`, `isExpenseInquiry`, `formatExpenseHistory`)
  - processAIResponse 함수에 소비내역 조회 로직 추가
  - 텍스트 입력으로도 소비내역 입력 및 조회 가능
  - "현재 내 소비내역 알려줄래?" 같은 질문에 실제 데이터 응답
- 2025-05-26: /consumption 페이지 UI 개선 ✅
  - 카테고리별 소비 현황(막대 차트) 제거
  - 소비 추이(라인 차트), 카테고리별 소비 비율(도넛 차트), 요약 정보 유지
  - 파이 차트를 도넛 차트로 개선 (중앙에 총 소비 금액 표시)
  - ConsumList(소비 내역 리스트)와 카테고리 필터 유지
  - 차트 제목 "소비 현황" → "소비 분석"으로 변경
- 2025-05-26: 금액 표시 포맷팅 개선 ✅
  - 모든 금액 표시에서 .00 소수점 제거
  - ConsumList.js, ConsumCard.js, ConsumDetailModal.js, ExpenseChart.js 수정
  - Math.floor()와 parseFloat() 사용하여 정수 변환 처리
  - 천 단위 콤마 구분자 유지
- 2025-05-26: 미사용 API 경로 정리 ✅
  - `/api/v1/match` 경로가 사용되지 않음을 확인
  - 프론트엔드, 백엔드, AI 서버 전체에서 해당 API 호출 코드 없음
  - 백엔드에서 해당 경로에 대한 명시적 차단 미들웨어 추가 (410 상태코드)
  - 불필요한 API 요청으로 인한 404 에러 방지
- 2025-05-26: AI 챗봇 소비내역 조회 기능 대폭 개선 ✅
  - 기간별 소비내역 조회 지원 (오늘/어제/이번주/지난주/이번달/지난달)
  - 구체적 월 지정 지원 ("4월 소비 리포트", "3월 내역" 등)  
  - 이번주 날짜 계산 로직 수정 (월요일~일요일 전체 주 표시)
  - 사용자 요청에 맞는 적절한 응답 포맷 구현
  - 일반 조회 vs 리포트 조회 구분 처리
  - 날짜별 그룹핑 및 음성 친화적 응답 생성
  - 카테고리별 통계 분석 및 퍼센트 계산 기능
  - 과거 날짜 소비내역 입력 기능 추가 ✨
    * "어제 5천원 점심 먹었어", "3일전 2만원 쇼핑했어" 등
    * "5월 20일에 1만원 썼어", "15일에 커피 마셨어" 등
    * 프론트엔드: parseExpenseFromInput 함수 날짜 파싱 기능 추가
    * 백엔드: ConsumptionController, ConsumptionService transactionDate 지원
- 2025-05-26: 대화형 소비내역 입력 시스템 구현 완료 ✨
  - 날짜 없는 소비내역 입력 시 AI가 날짜 확인하는 대화 플로우 추가
  - 사용자: "8000원 점심 먹었어" → AI: "언제 드셨나요?" → 사용자: "어제" → AI: "5월 25일로 저장했어요!"
  - 대화 상태 관리 시스템 (pendingExpenseData, waitingForDateConfirmation)
  - 날짜 파싱 확장 ("오늘", "어제", "3일 전", "5월 20일" 등)
  - 사용자 친화적 날짜 확인 메시지 생성
  - 기존 날짜 포함 소비내역은 즉시 저장 (기존 기능 유지)
  - chatScript.js 완전 재작성으로 대화형 시스템 구현
- 2025-05-27: **구조 리팩토링 완료** ✨🏗️
  - **문제**: 프론트엔드에 비즈니스 로직과 서비스 로직이 과도하게 집중됨
  - **백엔드 개선**:
    * `aiChatService.js` 생성 - AI 처리 로직 백엔드로 이관
    * 소비내역 파싱, 날짜 계산, 카테고리 추론 로직 백엔드로 이동
    * 대화형 처리, 응답 생성 로직 백엔드로 이동
    * `consumptionService.js`에 기간별 날짜 범위 계산 함수 추가
    * `aiChatController.js`, `aiChatRoutes.js` 생성
    * API 엔드포인트: `/api/v1/ai-chat/message`, `/api/v1/ai-chat/reset-session`
  - **프론트엔드 단순화**:
    * `chatScript_new.js` 생성 - UI 로직만 남기고 비즈니스 로직 제거
    * 백엔드 API 호출 중심으로 단순화
    * 음성 인식, UI 상태 관리만 프론트엔드에서 처리
    * 서비스 로직은 백엔드 API로 완전 이관
  - **아키텍처 개선**:
    * 관심사 분리: UI ↔ 비즈니스 로직 완전 분리
    * 확장성 향상: 비즈니스 로직 중앙화
    * 유지보수성 개선: 단일 책임 원칙 적용
- 2025-05-27: **회원가입 정보 입력 개선** ✨
  - **추가된 필드**: 생년월일, 성별 입력 필드 추가
  - **프론트엔드 개선**:
    * InfoInput.js에 생년월일(date input), 성별(select) 필드 추가
    * 필드 validation 로직 업데이트 (모든 필드 필수)
    * CSS 스타일링 개선 (date input, select 요소)
  - **백엔드 개선**:
    * users.js 라우터에 생년월일, 성별 validation 추가
    * 기존 User 모델에 이미 userBirth, userGender 필드 존재 확인
  - **DB 구조**: 별도 수정 불필요 (이미 필드 존재)
  - **입력 필드**: 이름, 전화번호, 생년월일, 성별 (4개 필드 모두 필수)
- 2025-05-27: **지병 선택 페이지 추가** ✨🏥
  - **새로운 페이지**: `/signup/diseaseselect` 추가
  - **회원가입 플로우 개선**:
    * infoinput → diseaseselect → verifycode 순서로 변경
    * 기존: infoinput → verifycode
    * 개선: infoinput → diseaseselect → verifycode
  - **지병 선택 기능**:
    * 카테고리별 질병 분류 (만성질환, 중증질환, 정신건강, 기타)
    * 복수 선택 가능
    * "없음" 선택 시 다른 선택 자동 해제
    * 선택된 항목 실시간 요약 표시
  - **포함된 질병**: 당뇨병, 고혈압, 심장병, 관절염, 뇌졸중, 암, 신장질환, 간질환, 폐질환, 골다공증, 우울증, 치매, 기타
  - **UI/UX**: 직관적인 선택 인터페이스, 카테고리별 그룹핑, 선택 상태 시각적 피드백
  - **데이터 저장**: 기존 User 모델의 `userDisease` 필드 활용
  - **라우팅 업데이트**: App.js, SignUpHeader.js, 네비게이션 링크 모두 수정 완료
  - **UI 개선**: 직접 입력 필드 추가, 이전/다음 버튼 하단 고정
    * 직접 입력 필드로 목록에 없는 질병 추가 가능
    * "없음" 선택 시 직접 입력 필드 비활성화
    * 버튼을 화면 하단에 고정하여 스크롤과 관계없이 접근 가능
